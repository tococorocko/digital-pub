<div class="chat-name">
  <% if @chat.team.present? %>
    <%= image_tag @chat.team.logo %> <h2><%= @chat.team.name %> table</h2>
  <% else %>
    <%= image_tag 'beer.svg' %><h2>Stammtisch</h2>
  <% end %>
</div>

<div class="messages" style="background-image: linear-gradient(-205deg, rgb(255, 255, 255) 0%, rgba(255, 255, 255, 0.91) 50%), url('http://irishpubcompany.com/wp-content/uploads/2015/12/Capture1.jpg');">
  <% @chat.messages.order(created_at: :asc).each do |message| %>
    <%= render "messages/message", message: message, user_is_messages_author: message.user == current_user %>
  <% end %>
</div>

<div id="create-message">
  <%= simple_form_for [@chat.game, @chat, Message.new], html: { style: 'display:flex' },remote: true do |f| %>
    <%= f.input :content, label: false %>
    <%= f.submit ">", class:'btn-round-green' %>
  <% end %>

</div>

<%= content_for(:after_js) do %>
  <script>
    scrollLastMessageIntoView();
    App['chat_<%= @chat.id %>'] = App.cable.subscriptions.create({ channel: 'ChatsChannel', chat_id: <%= @chat.id %> }, {
      received: (data) => {
        if (data.current_user_id !== <%= current_user.id %>) {
          const messagesContainer = document.querySelector('.messages');
          messagesContainer.insertAdjacentHTML('beforeend', data.message_partial);
          scrollLastMessageIntoView();
        }
      }
    })
  </script>
<% end %>


